<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>Watch</title>
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <link href="/static/css/bootstrap-theme.min.css" rel="stylesheet">
	<link href="css/video-js.css" rel="stylesheet">	
	<script src="js/videojs-ie8.min.js"></script>
    <link href="css/watch.css" rel="stylesheet">
</head>

<body>

	<div class="m embed-responsive embed-responsive-16by9">
		<video  id="my-video" class="video-js" controls preload="auto"
		  poster="img/player_bg.jpg" data-setup="{}">
			<source id="source" >
			<!--type='application/x-mpegURL'>-->
		  </video>


	</div>
		<div class="boxx">
			
			星空直播^ ^<br>
			按 <kbd><kbd>Alt</kbd> + <kbd>F4</kbd></kbd> 可以上天
		</div>

		<div class="boxx">
			<from>
				<input id="in" style="width:80%;"/>

				<button id="submit" style="width:15%;" onclick="sendMessage()">发送</button>

			</from>

			<divclass="content">
				<h1>弹幕</h1>
				<p  id="danmu" style="padding-left:20px;">
				</p>
			</div>
		</div>
</body>
    	<script src="/static/js/jquery.min.js"></script>
		<script src="/static/js/bootstrap.js"></script>
		<script type="text/javascript" src="js/video.js"></script>


		<script type="text/javascript" src="js/videojs-contrib-hls.js"></script>
		<script type="text/javascript">
			function getUrlParam(name) {
				  var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
				  var r = window.location.search.substr(1).match(reg); //匹配目标参数
				  if (r != null) return unescape(r[2]); return ""; //返回参数值
			}

			$('#source')[0].setAttribute("src","/hls/"+getUrlParam("app")+".m3u8");
			$('#source')[0].setAttribute("type",'application/x-mpegURL');
			function resize() {
				$('#my-video').width($('#my-video').parent()[0].clientWidth);
				$('#my-video').height($('#my-video').parent()[0].clientHeight);
			}

			$(window).resize(resize);


			var myPlayer = videojs('my-video');
			videojs("my-video").ready(function(){
 				resize();
				var myPlayer = this;
				//myPlayer.play();

			});
			
		</script>

		<script src="/static/js/bucket.js"></script>
		<!--<script src="../dist/js/danmuplayer.min.js"></script>-->
		<script>

			var client = new BucketClient(window.location.host,80,"websocket/" + getUrlParam("app"));
			client.connect(SocketEvent);

			function SocketEvent(status,evt){
				switch(status){
					case 'open':
						client.sendCommand(GetDanmuCommand());
						client.sendCommand(GetOnlineListCommand());
						break;
					case 'onmsg':
						var obj = evt['content'];
						//var obj = JSON.parse(evt['content']);
						 document.getElementById("danmu").innerHTML = "" + obj + "<br><br>" + document.getElementById("danmu").innerHTML;
						console.log(obj);
						break;
					case 'unknow':
						console.log(evt);
						break;
				}
			}

			function sendMessage(){
				var str = document.getElementById("in").value;
				client.sendCommand(new MessageBody(str,"","","","","","").toCommand());
				document.getElementById("in").value = "";
			}

		</script>
</html>
